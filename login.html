<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Documento sin título</title>
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="http://sscol.jebal.comuv.com/css/font.css">
		<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Montserrat' type='text/css'>
		<link rel="stylesheet" href="css/main.css">
	</head>
	<body>
		<div class="container" id="header">
			<div class="row top_logo_row">
				<img class="top_logo" src="img/logo.png" width="309" height="57" />
			</div>
			<div class="row top_message_row">
				BIENVENIDO
			</div>
		</div>
		<div class="container" id="content">
			<div class="row content_login_row">
				<form id="login-form" action="login">
					<div id="inputs" class="input">
						<div>
							<input type="mail" placeholder="Usuario" class="input_email" name="username">
						</div>
						<div>
							<input type="password" placeholder="Contraseña" class="input_pass" name="password">
						</div>
						<div>
							<button class="login_button">ENTRAR</button>
						</div>
						<div class="olvido_url">
							<a href="olvido.html">Olvidaste la contraseña</a>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="container" id="footer">
			<div class="row" id="footer_row">
				J-40194581-3
			</div>
		</div>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.serialize-object.min.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/marina.js"></script>
	<script type="text/javascript">
		$( document ).on( 'ready', function() {
			if ( $.cookie( 'token-auth' ) ) {
				window.location.replace( hostURL+'/schedule.html' );
			};
		});

		// bind to the submit event of our form
		$( '#login-form' ).on( 'submit', function( event ) {
			// prevent default posting of form
			event.preventDefault();

			// setup some local variables
			var $form = $(this);
			// let's select and cache all the fields
			var $inputs = $form.find('input');
			// serialize the data in the form
			var serializedData = $form.serialize();

			// let's disable the inputs for the duration of the ajax request
			// Note: we disable elements AFTER the form data has been serialized.
			// Disabled form elements will not be serialized.
			$inputs.prop('disabled', true);

			// variable to hold request
			var request;

			// abort any pending request
			if (request) {
				request.abort();
			}

			// fire off the request
			request = $.ajax({
				url: 		apiURL+'/api/token-auth/',
				type: 		'post',
				data: 		serializedData,
				dataType: 	'json',
				xhrFields: 	{ withCredentials: false },
				statusCode: {
								400: function() {
									$( '#inputs' ).parent().prepend( '<div class="error">Correo electrónico o contraseña inválida.</div>' )
								}
							}
			});

			// callback handler that will be called on success
			request.done(function (response, textStatus, jqXHR){
				// Set the authorization cookie
				$.cookie( 'token-auth', 'Token '+response.token, { expires: 7 } );
				window.location.replace( hostURL+'/schedule.html' );
			});

			// callback handler that will be called regardless
			// if the request failed or succeeded
			request.always(function () {
				// reenable the inputs
				$inputs.prop('disabled', false);
				$( '.error' ).remove();
			});
		});
	</script>
	</body>
</html>
