<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>HMPE : Agendar</title>
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="http://sscol.jebal.comuv.com/css/font.css">
		<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Montserrat' type='text/css'>
		<link rel="stylesheet" href="css/main.css">
	</head>
	<body>
		<div class="container" id="header">
			<div class="row top_logo_row">
				<img class="top_logo" src="img/logo.png" width="309" height="57" />
			</div>
			<div class="row top_message_row">
				AGENDAR
			</div>
		</div>
		<div class="container" id="content">
			<div class="row content_login_row">
				<form id="schedule-form" action="schedule">
					<div id="inputs" class="input">
						<div>
							<select name="action" id="action">
								<option value="IN"><span class=" glyphicon glyphicon-arrow-down"></span> Subir embarcaci칩n</option>
								<option value="OUT"><span class=" glyphicon glyphicon-arrow-down"></span> Bajar embarcaci칩n</option>
							</select>
						</div>
						<div>
							<select name="boat"  id="boats"></select>
							<input type="hidden" name="parking_lot" />
							<input type="hidden" name="user" />
						</div>
						<div>
							<input type="datetime" placeholder="Fecha y hora" name="action_date">
						</div>
						<div>
							<button class="reservar_button  btn btn-default">RESERVAR</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="container" id="footer">
			<div class="row" id="footer_row">
				J-40194581-3
			</div>
		</div>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.serialize-object.min.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/marina.js"></script>
	<script type="text/javascript">
		$( document ).on( 'ready', function() {
			if ( !$.cookie( 'token-auth' ) ) {
				window.location.replace( hostURL+'/login.html'  );
			}

			getUserBoats('boats');

			var userinfo = jQuery.parseJSON( $.cookie( 'user-info' ) );

			$( 'input[name="user"]' ).val( userinfo.id );

			$( '#boats' ).on( 'change', function (e) {
				var optionSelected = $( this ).find('option:selected');
				$( 'input[name="parking_lot"]' ).val( optionSelected.attr('pl') );
			});
		});

		// bind to the submit event of our form
		$( '#schedule-form' ).on( 'submit', function( event ) {
			// prevent default posting of form
			event.preventDefault();

			// setup some local variables
			var $form = $(this);
			// let's select and cache all the fields
			var $inputs = $form.find('input,select');
			// serialize the data in the form
			var serializedData = $form.serialize();

			// let's disable the inputs for the duration of the ajax request
			// Note: we disable elements AFTER the form data has been serialized.
			// Disabled form elements will not be serialized.
			$inputs.prop('disabled', true);

			// variable to hold request
			var request;

			// abort any pending request
			if (request) {
				request.abort();
			}

			// fire off the request
			request = $.ajax({
				url: 		apiURL+'/api/user/schedule',
				type: 		'post',
				data: 		serializedData,
				dataType: 	'json',
				headers: 	{ Authorization : $.cookie( 'token-auth' ) },
				xhrFields: 	{ withCredentials: false },
				statusCode: {
								400: function() {
									$( '#inputs' ).parent().prepend( '<div class="error">La informaci칩n que ha introducido es inv치lida</div>' )
								},
								401: function() {
									$.removeCookie( 'token-auth' );
									window.location.replace( hostURL+'/login.html' );
								}
							}
			});

			// callback handler that will be called on success
			request.done(function (response, textStatus, jqXHR){
				window.location.replace( hostURL+'/schedule.html' );
			});

			// callback handler that will be called regardless
			// if the request failed or succeeded
			request.always(function () {
				// reenable the inputs
				$inputs.prop('disabled', false);
				$( '.error' ).remove();
			});
		});
		
	</script>
	</body>
</html>

